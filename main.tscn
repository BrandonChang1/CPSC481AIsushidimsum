[gd_scene load_steps=14 format=3 uid="uid://unrxlwdu170"]

[ext_resource type="Texture2D" uid="uid://cbw7j851kawpy" path="res://images/smallsesame.png" id="1_tg8bt"]
[ext_resource type="Texture2D" uid="uid://d2g585c1du0r4" path="res://images/smallsesame_sq.png" id="2_hj5bs"]
[ext_resource type="Texture2D" uid="uid://8n1ck68t34y6" path="res://images/largesesame_sq.png" id="3_wolko"]
[ext_resource type="Texture2D" uid="uid://bng3mt3l5nejh" path="res://images/egg_sq.png" id="4_fhocb"]
[ext_resource type="Texture2D" uid="uid://b05veub2utk4p" path="res://images/chive_sq.png" id="4_wy32f"]
[ext_resource type="Texture2D" uid="uid://b4cxs8g8pg4f0" path="res://images/shrimp_sq.png" id="5_82ukx"]
[ext_resource type="Texture2D" uid="uid://csckvcl4ludgf" path="res://images/turnip_sq.png" id="6_l42ue"]
[ext_resource type="Texture2D" uid="uid://evusbtpc7po4" path="res://images/shumai_sq.png" id="7_q68mw"]
[ext_resource type="Texture2D" uid="uid://bvevxkj6ufquj" path="res://images/steamed_sq.png" id="8_k300g"]
[ext_resource type="Texture2D" uid="uid://b6gdt01u6d75l" path="res://images/chopsticks.png" id="10_3l2kh"]

[sub_resource type="GDScript" id="GDScript_pa3jy"]
script/source = "#the menubuttons should show choices left to right, or in a grid, but whatever
#make a large dining table for the background
# for opponents, do simple label counter, for yourself do stacked icons
extends Control

var bowls = []
var rotations_start = [0, 2*PI/6, 2*PI/6 * 2, 2*PI/6 * 3, 2*PI/6 * 4, 2*PI/6 * 5] # need to use radians. if degrees, floating point bullshit occurs
var rotation_degrees_remaining:int = 0
var distances = [[3, 2, 1, 0, 1, 2], [0, 1, 2, 3, 2, 1]] # should add more logic to this. 0th element is distance from each bowl to player1, etc

var all_ready = false

enum {
	small_sesame,
	large_sesame,
	chive,
	egg,
	shrimp,
	turnip,
	shumai,
	steamed
}

enum {
	player1,
	player2,
	#player3,
	#player4,
	#player5,
	#player6
}

const num_players = 2
var curr_turn = 0
var player_foods: Array[Array] = []

var autoturn = false

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	for n in num_players:
		player_foods.append([0,0,0,0,0,0,0,0]) # watch out, this is a shallow copy. see the abandoned mahjong for more on this.
	
	var bowl0 = $Bowl0
	var bowl1 = $Bowl1
	var bowl2 = $Bowl2
	var bowl3 = $Bowl3
	var bowl4 = $Bowl4
	var bowl5 = $Bowl5
	bowls = [bowl0, bowl1, bowl2, bowl3, bowl4, bowl5]
	for n in 6:
		bowls[n].set_rotation(rotations_start[n])
	# print(get_tree().get_nodes_in_group(\"rotators\"))
	all_ready = true	# not sure if this is even necessary
	
	
	

# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	if all_ready:
		if rotation_degrees_remaining != 0:
			get_tree().call_group(\"rotators\", \"rotate\", 2)
			#for n in 6:
				#bowls[n].set_rotation_degrees(bowls[n].get_rotation_degrees() + 2)
			rotation_degrees_remaining -= 2

func _on_menu_button_food_taken(bowl: int, taken: int, revealed: int) -> void:
	player_foods[curr_turn][taken] += 1
	# make new function that does the following: increment the appropriate item, updates the counter. counter needs to be in lockstep with the array variable. and also calculate poitn value.
	print_status()

func counter_update() -> void:
	pass

func print_status() -> void:
	print(player_foods)

func inc_turn() -> void:
	curr_turn += 1
	if curr_turn == num_players:
		curr_turn = 0
	print(\"now turn for player \", (curr_turn + 1))


func _on_button_pressed(arg1:String) -> void:
	if arg1 == \"turn\":
		inc_turn()
	if arg1 == \"ccw\":
		print(\"ccw button pressed\")
		rotate_board(-1)
	if arg1 == \"cw\":
		print(\"cw button pressed\")
		rotate_board(1)

func rotate_board(arg1:int) -> void:
		rotation_degrees_remaining += 60

func _on_check_box_toggled(toggled_on: bool) -> void:
	autoturn = toggled_on
	print(autoturn)
"

[sub_resource type="GDScript" id="GDScript_1dx7h"]
script/source = "extends MenuButton

const bowl_index:int = 0
var current_item = 0

# should these be exports in the main scene instead?
var smallsesame_image = preload(\"res://images/smallsesame.png\")
var largesesame_image = preload(\"res://images/largesesame.png\")
var chive_image = preload(\"res://images/chive.png\")
var egg_image = preload(\"res://images/egg.png\")
var shrimp_image = preload(\"res://images/shrimp.png\")
var turnip_image = preload(\"res://images/turnip.png\")
var shumai_image = preload(\"res://images/shumai.png\")
var steamed_image = preload(\"res://images/steamed.png\")


signal food_taken(bowl:int,taken:int,revealed:int)

# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	self.get_popup().id_pressed.connect(_on_item_menu_pressed)


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	pass

func _on_item_menu_pressed(id: int):
	print(\"Bowl \", bowl_index, \" was \", current_item , \" now \", id)
	food_taken.emit(bowl_index,current_item,id)
	current_item = id
	match id:
		0:
			set_button_icon(smallsesame_image)
		1:
			set_button_icon(largesesame_image)
		2:
			set_button_icon(chive_image)
		3:
			set_button_icon(egg_image)
		4:
			set_button_icon(shrimp_image)
		5:
			set_button_icon(turnip_image)
		6:
			set_button_icon(shumai_image)
		7:
			set_button_icon(steamed_image)

func rotate(degrees: int) -> void:
	self.set_rotation_degrees(self.get_rotation_degrees() + degrees)
	print(self.name, \" rotated\")
"

[sub_resource type="GDScript" id="GDScript_cfk01"]
resource_name = "chopstick"
script/source = "extends TextureRect


# Called when the node enters the scene tree for the first time.
func _ready() -> void:
	pass # Replace with function body.


# Called every frame. 'delta' is the elapsed time since the previous frame.
func _process(delta: float) -> void:
	pass

func rotate(degrees: int) -> void:
	self.set_rotation_degrees(self.get_rotation_degrees() + degrees)
	print(self.name, \" rotated\")
"

[node name="Control" type="Control"]
layout_mode = 3
anchors_preset = 15
anchor_right = 1.0
anchor_bottom = 1.0
grow_horizontal = 2
grow_vertical = 2
script = SubResource("GDScript_pa3jy")
metadata/_edit_lock_ = true

[node name="Bowl0" type="MenuButton" parent="." groups=["bowls", "rotators"]]
unique_name_in_owner = true
layout_mode = 1
anchors_preset = -1
offset_left = 792.0
offset_top = 304.0
offset_right = 940.0
offset_bottom = 451.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(72, 240)
theme_override_icons/icon = ExtResource("1_tg8bt")
expand_icon = true
item_count = 8
popup/item_0/text = "Small Sesame Ball"
popup/item_0/icon = ExtResource("2_hj5bs")
popup/item_1/text = "Large Sesame Ball"
popup/item_1/icon = ExtResource("3_wolko")
popup/item_1/id = 1
popup/item_2/text = "Chive Dumpling"
popup/item_2/icon = ExtResource("4_wy32f")
popup/item_2/id = 2
popup/item_3/text = "Egg Tart"
popup/item_3/icon = ExtResource("4_fhocb")
popup/item_3/id = 3
popup/item_4/text = "Shrimp Dumpling"
popup/item_4/icon = ExtResource("5_82ukx")
popup/item_4/id = 4
popup/item_5/text = "Turnip Cake"
popup/item_5/icon = ExtResource("6_l42ue")
popup/item_5/id = 5
popup/item_6/text = "Shumai Dumpling"
popup/item_6/icon = ExtResource("7_q68mw")
popup/item_6/id = 6
popup/item_7/text = "Steamed Bun"
popup/item_7/icon = ExtResource("8_k300g")
popup/item_7/id = 7
script = SubResource("GDScript_1dx7h")
metadata/bowl_index = 0
metadata/current_item = 0

[node name="Bowl1" type="MenuButton" parent="." groups=["bowls", "rotators"]]
unique_name_in_owner = true
layout_mode = 1
anchors_preset = -1
offset_left = 792.0
offset_top = 304.0
offset_right = 940.0
offset_bottom = 451.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(72, 240)
theme_override_icons/icon = ExtResource("1_tg8bt")
expand_icon = true
item_count = 8
popup/item_0/text = "Small Sesame Ball"
popup/item_0/icon = ExtResource("2_hj5bs")
popup/item_1/text = "Large Sesame Ball"
popup/item_1/icon = ExtResource("3_wolko")
popup/item_1/id = 1
popup/item_2/text = "Chive Dumpling"
popup/item_2/icon = ExtResource("4_wy32f")
popup/item_2/id = 2
popup/item_3/text = "Egg Tart"
popup/item_3/icon = ExtResource("4_fhocb")
popup/item_3/id = 3
popup/item_4/text = "Shrimp Dumpling"
popup/item_4/icon = ExtResource("5_82ukx")
popup/item_4/id = 4
popup/item_5/text = "Turnip Cake"
popup/item_5/icon = ExtResource("6_l42ue")
popup/item_5/id = 5
popup/item_6/text = "Shumai Dumpling"
popup/item_6/icon = ExtResource("7_q68mw")
popup/item_6/id = 6
popup/item_7/text = "Steamed Bun"
popup/item_7/icon = ExtResource("8_k300g")
popup/item_7/id = 7
script = SubResource("GDScript_1dx7h")
metadata/bowl_index = 0
metadata/current_item = 0

[node name="Bowl2" type="MenuButton" parent="." groups=["bowls", "rotators"]]
unique_name_in_owner = true
layout_mode = 1
anchors_preset = -1
offset_left = 792.0
offset_top = 304.0
offset_right = 940.0
offset_bottom = 451.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(72, 240)
theme_override_icons/icon = ExtResource("1_tg8bt")
expand_icon = true
item_count = 8
popup/item_0/text = "Small Sesame Ball"
popup/item_0/icon = ExtResource("2_hj5bs")
popup/item_1/text = "Large Sesame Ball"
popup/item_1/icon = ExtResource("3_wolko")
popup/item_1/id = 1
popup/item_2/text = "Chive Dumpling"
popup/item_2/icon = ExtResource("4_wy32f")
popup/item_2/id = 2
popup/item_3/text = "Egg Tart"
popup/item_3/icon = ExtResource("4_fhocb")
popup/item_3/id = 3
popup/item_4/text = "Shrimp Dumpling"
popup/item_4/icon = ExtResource("5_82ukx")
popup/item_4/id = 4
popup/item_5/text = "Turnip Cake"
popup/item_5/icon = ExtResource("6_l42ue")
popup/item_5/id = 5
popup/item_6/text = "Shumai Dumpling"
popup/item_6/icon = ExtResource("7_q68mw")
popup/item_6/id = 6
popup/item_7/text = "Steamed Bun"
popup/item_7/icon = ExtResource("8_k300g")
popup/item_7/id = 7
script = SubResource("GDScript_1dx7h")
metadata/bowl_index = 0
metadata/current_item = 0

[node name="Bowl3" type="MenuButton" parent="." groups=["bowls", "rotators"]]
unique_name_in_owner = true
layout_mode = 1
anchors_preset = -1
offset_left = 792.0
offset_top = 304.0
offset_right = 940.0
offset_bottom = 451.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(72, 240)
theme_override_icons/icon = ExtResource("1_tg8bt")
expand_icon = true
item_count = 8
popup/item_0/text = "Small Sesame Ball"
popup/item_0/icon = ExtResource("2_hj5bs")
popup/item_1/text = "Large Sesame Ball"
popup/item_1/icon = ExtResource("3_wolko")
popup/item_1/id = 1
popup/item_2/text = "Chive Dumpling"
popup/item_2/icon = ExtResource("4_wy32f")
popup/item_2/id = 2
popup/item_3/text = "Egg Tart"
popup/item_3/icon = ExtResource("4_fhocb")
popup/item_3/id = 3
popup/item_4/text = "Shrimp Dumpling"
popup/item_4/icon = ExtResource("5_82ukx")
popup/item_4/id = 4
popup/item_5/text = "Turnip Cake"
popup/item_5/icon = ExtResource("6_l42ue")
popup/item_5/id = 5
popup/item_6/text = "Shumai Dumpling"
popup/item_6/icon = ExtResource("7_q68mw")
popup/item_6/id = 6
popup/item_7/text = "Steamed Bun"
popup/item_7/icon = ExtResource("8_k300g")
popup/item_7/id = 7
script = SubResource("GDScript_1dx7h")
metadata/bowl_index = 0
metadata/current_item = 0

[node name="Bowl4" type="MenuButton" parent="." groups=["bowls", "rotators"]]
unique_name_in_owner = true
layout_mode = 1
anchors_preset = -1
offset_left = 792.0
offset_top = 304.0
offset_right = 940.0
offset_bottom = 451.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(72, 240)
theme_override_icons/icon = ExtResource("1_tg8bt")
expand_icon = true
item_count = 8
popup/item_0/text = "Small Sesame Ball"
popup/item_0/icon = ExtResource("2_hj5bs")
popup/item_1/text = "Large Sesame Ball"
popup/item_1/icon = ExtResource("3_wolko")
popup/item_1/id = 1
popup/item_2/text = "Chive Dumpling"
popup/item_2/icon = ExtResource("4_wy32f")
popup/item_2/id = 2
popup/item_3/text = "Egg Tart"
popup/item_3/icon = ExtResource("4_fhocb")
popup/item_3/id = 3
popup/item_4/text = "Shrimp Dumpling"
popup/item_4/icon = ExtResource("5_82ukx")
popup/item_4/id = 4
popup/item_5/text = "Turnip Cake"
popup/item_5/icon = ExtResource("6_l42ue")
popup/item_5/id = 5
popup/item_6/text = "Shumai Dumpling"
popup/item_6/icon = ExtResource("7_q68mw")
popup/item_6/id = 6
popup/item_7/text = "Steamed Bun"
popup/item_7/icon = ExtResource("8_k300g")
popup/item_7/id = 7
script = SubResource("GDScript_1dx7h")
metadata/bowl_index = 0
metadata/current_item = 0

[node name="Bowl5" type="MenuButton" parent="." groups=["bowls", "rotators"]]
unique_name_in_owner = true
layout_mode = 1
anchors_preset = -1
offset_left = 792.0
offset_top = 304.0
offset_right = 940.0
offset_bottom = 451.0
grow_horizontal = 2
grow_vertical = 2
pivot_offset = Vector2(72, 240)
theme_override_icons/icon = ExtResource("1_tg8bt")
expand_icon = true
item_count = 8
popup/item_0/text = "Small Sesame Ball"
popup/item_0/icon = ExtResource("2_hj5bs")
popup/item_1/text = "Large Sesame Ball"
popup/item_1/icon = ExtResource("3_wolko")
popup/item_1/id = 1
popup/item_2/text = "Chive Dumpling"
popup/item_2/icon = ExtResource("4_wy32f")
popup/item_2/id = 2
popup/item_3/text = "Egg Tart"
popup/item_3/icon = ExtResource("4_fhocb")
popup/item_3/id = 3
popup/item_4/text = "Shrimp Dumpling"
popup/item_4/icon = ExtResource("5_82ukx")
popup/item_4/id = 4
popup/item_5/text = "Turnip Cake"
popup/item_5/icon = ExtResource("6_l42ue")
popup/item_5/id = 5
popup/item_6/text = "Shumai Dumpling"
popup/item_6/icon = ExtResource("7_q68mw")
popup/item_6/id = 6
popup/item_7/text = "Steamed Bun"
popup/item_7/icon = ExtResource("8_k300g")
popup/item_7/id = 7
script = SubResource("GDScript_1dx7h")
metadata/bowl_index = 0
metadata/current_item = 0

[node name="MaxSmallSesameCounter" type="Label" parent="."]
layout_mode = 0
offset_left = 364.0
offset_top = 283.0
offset_right = 457.0
offset_bottom = 341.0

[node name="MaxLargeSesameCounter" type="Label" parent="."]
layout_mode = 0
offset_left = 350.0
offset_top = 590.0
offset_right = 390.0
offset_bottom = 613.0

[node name="MaxChiveCounter" type="Label" parent="."]
layout_mode = 0
offset_left = 364.0
offset_top = 364.0
offset_right = 404.0
offset_bottom = 387.0

[node name="EndTurn" type="Button" parent="."]
layout_mode = 0
offset_left = 1227.0
offset_top = 643.0
offset_right = 1627.0
offset_bottom = 791.0
theme_override_font_sizes/font_size = 48
text = "End Turn"

[node name="CheckBox" type="CheckBox" parent="."]
layout_mode = 0
offset_left = 1227.0
offset_top = 512.0
offset_right = 1622.0
offset_bottom = 598.0
theme_override_font_sizes/font_size = 24
text = "Automatically Switch Turns"

[node name="Button" type="Button" parent="."]
layout_mode = 0
offset_left = 952.0
offset_top = 864.0
offset_right = 1115.0
offset_bottom = 942.0
text = "Clockwise"

[node name="Chopstick0" type="TextureRect" parent="." groups=["chopsticks", "rotators"]]
layout_mode = 0
offset_left = 824.0
offset_top = 256.0
offset_right = 904.0
offset_bottom = 336.0
pivot_offset = Vector2(40, 288)
texture = ExtResource("10_3l2kh")
script = SubResource("GDScript_cfk01")

[connection signal="food_taken" from="Bowl0" to="." method="_on_menu_button_food_taken"]
[connection signal="food_taken" from="Bowl1" to="." method="_on_menu_button_food_taken"]
[connection signal="food_taken" from="Bowl2" to="." method="_on_menu_button_food_taken"]
[connection signal="food_taken" from="Bowl3" to="." method="_on_menu_button_food_taken"]
[connection signal="food_taken" from="Bowl4" to="." method="_on_menu_button_food_taken"]
[connection signal="food_taken" from="Bowl5" to="." method="_on_menu_button_food_taken"]
[connection signal="pressed" from="EndTurn" to="." method="_on_button_pressed" binds= ["turn"]]
[connection signal="toggled" from="CheckBox" to="." method="_on_check_box_toggled"]
[connection signal="pressed" from="Button" to="." method="_on_button_pressed" binds= ["cw"]]
